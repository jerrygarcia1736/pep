{% extends "base.html" %}

{% block title %}Dashboard - Peptide Tracker{% endblock %}

<!-- Version 2.0 - Force cache refresh -->

{% block content %}
<!-- App-Style Header -->
<div class="mb-3">
    <h1 class="mb-2">
        <i class="bi bi-speedometer2"></i> Dashboard
    </h1>
    <p class="text-muted mb-0">Track your peptide protocols, vials, and injections all in one place. Have immediate answers with AI to any question you possibly have with <strong>Pep AI</strong>.</p>
</div>

<!-- Quick Actions -->
<div class="card mb-4 shadow-sm">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="bi bi-lightning-charge"></i> Quick Actions</h5>
    </div>
    <div class="card-body">
        <div class="row g-3">
            <div class="col-6 col-md-3">
                <a href="{{ url_for('log_injection') }}" class="btn btn-lg btn-success w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3">
                    <i class="bi bi-plus-circle mb-2" style="font-size: 2rem;"></i>
                    <span>Log Injection</span>
                </a>
            </div>
            <div class="col-6 col-md-3">
                <a href="{{ url_for('calculator') }}" class="btn btn-lg btn-info w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3">
                    <i class="bi bi-calculator mb-2" style="font-size: 2rem;"></i>
                    <span class="fw-semibold">Peptide Calculator</span>
                    <small class="text-white-50 mt-1" style="font-size: 0.7rem;">Calculate dosing & reconstitution</small>
                </a>
            </div>
            <div class="col-6 col-md-3">
                <a href="{{ url_for('chat') }}" class="btn btn-lg btn-gradient w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3 text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="bi bi-chat-dots-fill mb-2" style="font-size: 2rem;"></i>
                    <span class="fw-semibold">Pep AI</span>
                    <small class="text-white-75 mt-1" style="font-size: 0.7rem;">Ask anything about peptides</small>
                </a>
            </div>
            <div class="col-6 col-md-3">
                <a href="{{ url_for('add_protocol') }}" class="btn btn-lg btn-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3">
                    <i class="bi bi-calendar-plus mb-2" style="font-size: 2rem;"></i>
                    <span>New Protocol</span>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Stats Cards -->
<div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
        <div class="card bg-primary text-white h-100 shadow-sm">
            <div class="card-body py-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="card-title mb-1 opacity-75">Active Protocols</h6>
                        <p class="display-6 mb-0">{{ stats.active_protocols }}</p>
                    </div>
                    <i class="bi bi-calendar-check opacity-50" style="font-size: 1.5rem;"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card bg-success text-white h-100 shadow-sm">
            <div class="card-body py-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="card-title mb-1 opacity-75">Active Vials</h6>
                        <p class="display-6 mb-0">{{ stats.active_vials }}</p>
                    </div>
                    <i class="bi bi-box opacity-50" style="font-size: 1.5rem;"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card bg-info text-white h-100 shadow-sm">
            <div class="card-body py-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="card-title mb-1 opacity-75">This Week</h6>
                        <p class="display-6 mb-0">{{ stats.injections_this_week }}</p>
                        <small class="opacity-75">injections</small>
                    </div>
                    <i class="bi bi-activity opacity-50" style="font-size: 1.5rem;"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card bg-warning text-dark h-100 shadow-sm">
            <div class="card-body py-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="card-title mb-1 opacity-75">Peptides</h6>
                        <p class="display-6 mb-0">{{ stats.total_peptides }}</p>
                        <small class="opacity-75">in database</small>
                    </div>
                    <i class="bi bi-capsule opacity-50" style="font-size: 1.5rem;"></i>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Age Slider Recommendations -->
<div class="card shadow-sm mb-3">
  <div class="card-header bg-light d-flex align-items-center justify-content-between py-2">
    <div class="fw-semibold small">
      <i class="bi bi-sliders"></i> Age Slider (Recommendations)
    </div>
    <span class="badge text-bg-secondary" id="ageBadge">35</span>
  </div>
  <div class="card-body py-2">
    <div class="row g-2 align-items-center">
      <div class="col-12 col-lg-6">
        <label for="ageSlider" class="form-label mb-1 small">Age</label>
        <input type="range" class="form-range form-range-sm" min="18" max="85" value="35" step="1" id="ageSlider">
        <div class="d-flex justify-content-between small text-muted">
          <span>18</span><span>35</span><span>50</span><span>85</span>
        </div>

        <div class="mt-2">
          <div class="fw-semibold mb-1 small"><i class="bi bi-bullseye"></i> Goals</div>
          <div class="d-flex flex-wrap gap-1">
            <input type="checkbox" class="btn-check goalToggle" id="gFat" autocomplete="off" value="fat_loss">
            <label class="btn btn-outline-primary btn-sm py-1 px-2 small" for="gFat"><i class="bi bi-fire"></i> Fat loss</label>

            <input type="checkbox" class="btn-check goalToggle" id="gRec" autocomplete="off" value="recovery">
            <label class="btn btn-outline-success btn-sm py-1 px-2 small" for="gRec"><i class="bi bi-heart-pulse"></i> Recovery</label>

            <input type="checkbox" class="btn-check goalToggle" id="gSkin" autocomplete="off" value="skin">
            <label class="btn btn-outline-warning btn-sm py-1 px-2 small" for="gSkin"><i class="bi bi-droplet"></i> Skin</label>

            <input type="checkbox" class="btn-check goalToggle" id="gCog" autocomplete="off" value="cognition">
            <label class="btn btn-outline-info btn-sm py-1 px-2 small" for="gCog"><i class="bi bi-lightbulb"></i> Cognition</label>

            <input type="checkbox" class="btn-check goalToggle" id="gLong" autocomplete="off" value="longevity">
            <label class="btn btn-outline-secondary btn-sm py-1 px-2 small" for="gLong"><i class="bi bi-hourglass-split"></i> Longevity</label>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-6">
        <div class="d-flex align-items-center justify-content-between mb-1">
          <div class="fw-semibold small">Suggested "start here" list</div>
          <span class="badge bg-warning text-dark px-2 py-1" style="font-size: 0.85rem;">
            <i class="bi bi-star-fill" style="font-size: 1rem;"></i> Paid Version Only
          </span>
        </div>
        <div class="list-group mt-1" id="recoList">
          <div class="text-muted text-center py-3">
            <i class="bi bi-lock-fill" style="font-size: 1.5rem;"></i>
            <div class="mt-1 small">Premium feature</div>
            <div class="small">Upgrade to unlock</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



<div class="row">
    <!-- Active Protocols -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-calendar-check"></i> Active Protocols</h5>
            </div>
            <div class="card-body">
                {% if protocols %}
                    <div class="list-group list-group-flush">
                        {% for protocol in protocols %}
                        <a href="{{ url_for('protocol_detail', protocol_id=protocol.id) }}" 
                           class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">{{ protocol.name }}</h6>
                                <small class="text-muted">{{ protocol.peptide.name }}</small>
                            </div>
                            <p class="mb-1 small">
                                <span class="badge bg-primary">{{ protocol.dose_mcg }} mcg</span>
                                <span class="badge bg-info">{{ protocol.frequency_per_day }}x/day</span>
                            </p>
                            <small class="text-muted">
                                Started: {{ protocol.start_date.strftime('%Y-%m-%d') }}
                                {% if protocol.end_date %}
                                | Ends: {{ protocol.end_date.strftime('%Y-%m-%d') }}
                                {% endif %}
                            </small>
                        </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted text-center py-4">
                        No active protocols. 
                        <a href="{{ url_for('add_protocol') }}">Create one now</a>
                    </p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Recent Injections -->
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-clock-history"></i> Recent Injections</h5>
            </div>
            <div class="card-body">
                {% if recent_injections %}
                    <div class="list-group list-group-flush">
                        {% for injection in recent_injections %}
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">{{ injection.protocol.peptide.name }}</h6>
                                <small>{{ injection.timestamp.strftime('%m/%d %H:%M') }}</small>
                            </div>
                            <p class="mb-1 small">
                                <strong>{{ injection.dose_mcg }} mcg</strong> 
                                ({{ injection.volume_ml }} ml)
                                {% if injection.injection_site %}
                                | {{ injection.injection_site }}
                                {% endif %}
                            </p>
                            {% if injection.subjective_notes %}
                            <small class="text-muted">{{ injection.subjective_notes[:100] }}</small>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    <div class="text-center mt-3">
                        <a href="{{ url_for('history') }}" class="btn btn-sm btn-outline-primary">
                            View All History
                        </a>
                    </div>
                {% else %}
                    <p class="text-muted text-center py-4">
                        No injections logged yet. 
                        <a href="{{ url_for('log_injection') }}">Log your first one</a>
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Peptides in the News & Research -->
<div class="row">
    <!-- Peptides in the News -->
    <div class="col-md-6 mb-4">
        <div class="card h-100 shadow-sm">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="bi bi-newspaper"></i> Peptides in the News</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <!-- Example news items - In production, fetch from RSS feed -->
                    <a href="https://www.science.org/topic/peptides" target="_blank" class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">Science.org - Peptides Research</h6>
                            <small class="text-muted"><i class="bi bi-box-arrow-up-right"></i></small>
                        </div>
                        <p class="mb-1 small text-muted">Latest peptide research and breakthroughs</p>
                    </a>
                    <a href="https://pubmed.ncbi.nlm.nih.gov/?term=peptides" target="_blank" class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">PubMed - Peptide Studies</h6>
                            <small class="text-muted"><i class="bi bi-box-arrow-up-right"></i></small>
                        </div>
                        <p class="mb-1 small text-muted">Recent peer-reviewed peptide research</p>
                    </a>
                    <a href="https://www.nature.com/subjects/peptides" target="_blank" class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">Nature - Peptides Topic</h6>
                            <small class="text-muted"><i class="bi bi-box-arrow-up-right"></i></small>
                        </div>
                        <p class="mb-1 small text-muted">Nature's peptide research collection</p>
                    </a>
                </div>
                <div class="mt-3 small text-muted text-center">
                    <i class="bi bi-info-circle"></i> External links for educational purposes
                </div>
            </div>
        </div>
    </div>

    <!-- Scientific Studies -->
    <div class="col-md-6 mb-4">
        <div class="card h-100 shadow-sm">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-book"></i> Scientific Studies</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <!-- Popular peptide research links -->
                    <a href="https://pubmed.ncbi.nlm.nih.gov/?term=bpc-157" target="_blank" class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">BPC-157 Research</h6>
                            <small class="text-muted"><i class="bi bi-box-arrow-up-right"></i></small>
                        </div>
                        <p class="mb-1 small text-muted">Body Protection Compound studies</p>
                    </a>
                    <a href="https://pubmed.ncbi.nlm.nih.gov/?term=tb-500+thymosin" target="_blank" class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">TB-500 Research</h6>
                            <small class="text-muted"><i class="bi bi-box-arrow-up-right"></i></small>
                        </div>
                        <p class="mb-1 small text-muted">Thymosin Beta-4 clinical studies</p>
                    </a>
                    <a href="https://pubmed.ncbi.nlm.nih.gov/?term=retatrutide" target="_blank" class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">Retatrutide Research</h6>
                            <small class="text-muted"><i class="bi bi-box-arrow-up-right"></i></small>
                        </div>
                        <p class="mb-1 small text-muted">Triple agonist weight loss studies</p>
                    </a>
                    <a href="https://pubmed.ncbi.nlm.nih.gov/?term=semaglutide" target="_blank" class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">Semaglutide Research</h6>
                            <small class="text-muted"><i class="bi bi-box-arrow-up-right"></i></small>
                        </div>
                        <p class="mb-1 small text-muted">GLP-1 agonist clinical trials</p>
                    </a>
                </div>
                <div class="mt-3 small text-muted text-center">
                    <i class="bi bi-info-circle"></i> Links to peer-reviewed research
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}



{% block extra_js %}
{% endblock %}
<script>
// Age slider - just updates badge number (premium feature - no API calls)
(function() {
  const slider = document.getElementById("ageSlider");
  const badge = document.getElementById("ageBadge");

  if (!slider || !badge) return;

  slider.addEventListener("input", () => {
    badge.textContent = slider.value;
  });
})();
</script>
{% endblock %}
